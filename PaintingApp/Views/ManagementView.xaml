<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="PaintingApp.Views.ManagementView"
    x:Name="PageRoot"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:PaintingApp.Views"
    xmlns:viewmodels="using:PaintingApp.ViewModels"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Background="Transparent">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header with Breadcrumb -->
        <Border Grid.Row="0"
                Background="{ThemeResource AcrylicInAppFillColorDefaultBrush}"
                BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                BorderThickness="0,0,0,1"
                Padding="24,16">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <BreadcrumbBar Grid.Column="0"
                               ItemsSource="{x:Bind ViewModel.BreadcrumbItems, Mode=OneWay}"
                               VerticalAlignment="Center"/>

                <Button Grid.Column="1"
                        Command="{x:Bind ViewModel.RefreshAllCommand}"
                        ToolTipService.ToolTip="Refresh all data"
                        Padding="8,6">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="&#xE72C;" FontSize="14"/>
                        <TextBlock Text="Refresh"/>
                    </StackPanel>
                </Button>
            </Grid>
        </Border>

        <!-- Main Content with Tabs -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="280"/>
            </Grid.ColumnDefinitions>

            <!-- Tab Content Area with Acrylic Background -->
            <Border Grid.Column="0"
                    Background="{ThemeResource AcrylicInAppFillColorBaseBrush}">
                <TabView TabWidthMode="Equal"
                         IsAddTabButtonVisible="False"
                         CanDragTabs="False"
                         CanReorderTabs="False"
                         SelectedIndex="{x:Bind ViewModel.SelectedTabIndex, Mode=TwoWay}">

                    <!-- Boards Tab -->
                    <TabViewItem Header="Boards" IsClosable="False">
                        <TabViewItem.IconSource>
                            <FontIconSource Glyph="&#xE8D8;"/>
                        </TabViewItem.IconSource>
                        <TabViewItem.Content>
                            <Grid Padding="16">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>

                                <!-- Search and Actions Bar -->
                                <Grid Grid.Row="0" Margin="0,0,0,16">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="300"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <AutoSuggestBox Grid.Column="0"
                                                    PlaceholderText="Search boards..."
                                                    QueryIcon="Find"
                                                    Text="{x:Bind ViewModel.BoardSearchText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>

                                    <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="8">
                                        <TextBlock Text="{x:Bind ViewModel.Boards.Count, Mode=OneWay}"
                                                   VerticalAlignment="Center"
                                                   Style="{StaticResource CaptionTextBlockStyle}"
                                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                        <TextBlock Text="boards"
                                                   VerticalAlignment="Center"
                                                   Style="{StaticResource CaptionTextBlockStyle}"
                                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                    </StackPanel>
                                </Grid>

                                <!-- Content Area -->
                                <Grid Grid.Row="1">
                                    <!-- Empty State -->
                                    <StackPanel Visibility="{x:Bind ViewModel.HasBoards, Mode=OneWay, Converter={StaticResource InverseBoolToVisibilityConverter}}"
                                                VerticalAlignment="Center"
                                                HorizontalAlignment="Center"
                                                Spacing="16">
                                        <FontIcon Glyph="&#xE8D8;" FontSize="64" Opacity="0.4"/>
                                        <TextBlock Text="No boards found"
                                                   Style="{StaticResource SubtitleTextBlockStyle}"
                                                   HorizontalAlignment="Center"
                                                   Opacity="0.7"/>
                                        <TextBlock Text="Create a new board from the Drawing screen to get started"
                                                   Style="{StaticResource CaptionTextBlockStyle}"
                                                   HorizontalAlignment="Center"
                                                   Opacity="0.5"/>
                                    </StackPanel>

                                    <!-- Boards Grid -->
                                    <GridView ItemsSource="{x:Bind ViewModel.Boards, Mode=OneWay}"
                                              SelectionMode="None"
                                              IsItemClickEnabled="True"
                                              Visibility="{x:Bind ViewModel.HasBoards, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}">
                                        <GridView.ItemsPanel>
                                            <ItemsPanelTemplate>
                                                <ItemsWrapGrid Orientation="Horizontal" ItemWidth="300"/>
                                            </ItemsPanelTemplate>
                                        </GridView.ItemsPanel>
                                        <GridView.ItemTemplate>
                                            <DataTemplate x:DataType="viewmodels:BoardViewModel">
                                                <Grid Width="280"
                                                      Height="220"
                                                      Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                                      BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                                      BorderThickness="1"
                                                      CornerRadius="8"
                                                      Padding="16"
                                                      Margin="4">
                                                    <Grid.ContextFlyout>
                                                        <MenuFlyout>
                                                            <MenuFlyoutItem Text="Open"
                                                                            Command="{Binding ElementName=PageRoot, Path=ViewModel.OpenBoardCommand}"
                                                                            CommandParameter="{x:Bind}">
                                                                <MenuFlyoutItem.Icon>
                                                                    <FontIcon Glyph="&#xE8A7;"/>
                                                                </MenuFlyoutItem.Icon>
                                                            </MenuFlyoutItem>
                                                            <MenuFlyoutSeparator/>
                                                            <MenuFlyoutItem Text="Delete"
                                                                            Command="{Binding ElementName=PageRoot, Path=ViewModel.DeleteBoardCommand}"
                                                                            CommandParameter="{x:Bind}">
                                                                <MenuFlyoutItem.Icon>
                                                                    <FontIcon Glyph="&#xE74D;" Foreground="{ThemeResource SystemFillColorCriticalBrush}"/>
                                                                </MenuFlyoutItem.Icon>
                                                            </MenuFlyoutItem>
                                                        </MenuFlyout>
                                                    </Grid.ContextFlyout>
                                                    <Grid.RowDefinitions>
                                                        <RowDefinition Height="Auto"/>
                                                        <RowDefinition Height="*"/>
                                                        <RowDefinition Height="Auto"/>
                                                    </Grid.RowDefinitions>

                                                    <!-- Header -->
                                                    <Grid Grid.Row="0">
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="*"/>
                                                            <ColumnDefinition Width="Auto"/>
                                                        </Grid.ColumnDefinitions>

                                                        <TextBlock Grid.Column="0"
                                                                   Text="{x:Bind Name}"
                                                                   Style="{StaticResource SubtitleTextBlockStyle}"
                                                                   TextTrimming="CharacterEllipsis"
                                                                   MaxLines="1"/>

                                                        <Button Grid.Column="1"
                                                                Command="{Binding ElementName=PageRoot, Path=ViewModel.DeleteBoardCommand}"
                                                                CommandParameter="{x:Bind}"
                                                                Background="Transparent"
                                                                BorderThickness="0"
                                                                Padding="6"
                                                                ToolTipService.ToolTip="Delete Board">
                                                            <Button.Resources>
                                                                <SolidColorBrush x:Key="ButtonForegroundPointerOver" Color="{ThemeResource SystemFillColorCritical}"/>
                                                            </Button.Resources>
                                                            <FontIcon Glyph="&#xE74D;" FontSize="14"/>
                                                        </Button>
                                                    </Grid>

                                                    <!-- Preview Area -->
                                                    <Button Grid.Row="1"
                                                            Command="{Binding ElementName=PageRoot, Path=ViewModel.OpenBoardCommand}"
                                                            CommandParameter="{x:Bind}"
                                                            Padding="0"
                                                            Background="Transparent"
                                                            BorderThickness="0"
                                                            HorizontalAlignment="Stretch"
                                                            VerticalAlignment="Stretch"
                                                            Margin="0,12">
                                                        <Border Background="White"
                                                                BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                                                BorderThickness="1"
                                                                CornerRadius="4"
                                                                HorizontalAlignment="Stretch"
                                                                VerticalAlignment="Stretch">
                                                            <FontIcon Glyph="&#xE8D8;"
                                                                      FontSize="24"
                                                                      Opacity="0.3"
                                                                      HorizontalAlignment="Center"
                                                                      VerticalAlignment="Center"/>
                                                        </Border>
                                                    </Button>

                                                    <!-- Metadata -->
                                                    <StackPanel Grid.Row="2" Spacing="4">
                                                        <Grid>
                                                            <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="*"/>
                                                                <ColumnDefinition Width="Auto"/>
                                                            </Grid.ColumnDefinitions>

                                                            <TextBlock Grid.Column="0"
                                                                       Style="{StaticResource CaptionTextBlockStyle}"
                                                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}">
                                                                <Run Text="{x:Bind SizeDisplay}"/>
                                                                <Run Text="â€¢"/>
                                                                <Run Text="{x:Bind ShapeCount}"/>
                                                                <Run Text="shapes"/>
                                                            </TextBlock>
                                                        </Grid>

                                                        <TextBlock Style="{StaticResource CaptionTextBlockStyle}"
                                                                   Foreground="{ThemeResource TextFillColorTertiaryBrush}">
                                                            <Run Text="Modified:"/>
                                                            <Run Text="{x:Bind LastModified, Converter={StaticResource DateTimeToLocalStringConverter}}"/>
                                                        </TextBlock>
                                                    </StackPanel>
                                                </Grid>
                                            </DataTemplate>
                                        </GridView.ItemTemplate>
                                    </GridView>
                                </Grid>
                            </Grid>
                        </TabViewItem.Content>
                    </TabViewItem>

                    <!-- Templates Tab -->
                    <TabViewItem Header="Templates" IsClosable="False">
                        <TabViewItem.IconSource>
                            <FontIconSource Glyph="&#xE7C3;"/>
                        </TabViewItem.IconSource>
                        <TabViewItem.Content>
                            <Grid Padding="16">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>

                                <!-- Search and Actions Bar -->
                                <Grid Grid.Row="0" Margin="0,0,0,16">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="300"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <AutoSuggestBox Grid.Column="0"
                                                    PlaceholderText="Search templates..."
                                                    QueryIcon="Find"
                                                    Text="{x:Bind ViewModel.TemplateSearchText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>

                                    <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="8">
                                        <TextBlock Text="{x:Bind ViewModel.Templates.Count, Mode=OneWay}"
                                                   VerticalAlignment="Center"
                                                   Style="{StaticResource CaptionTextBlockStyle}"
                                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                        <TextBlock Text="templates"
                                                   VerticalAlignment="Center"
                                                   Style="{StaticResource CaptionTextBlockStyle}"
                                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                    </StackPanel>
                                </Grid>

                                <!-- Content Area -->
                                <Grid Grid.Row="1">
                                    <!-- Empty State -->
                                    <StackPanel Visibility="{x:Bind ViewModel.HasTemplates, Mode=OneWay, Converter={StaticResource InverseBoolToVisibilityConverter}}"
                                                VerticalAlignment="Center"
                                                HorizontalAlignment="Center"
                                                Spacing="16">
                                        <FontIcon Glyph="&#xE7C3;" FontSize="64" Opacity="0.4"/>
                                        <TextBlock Text="No templates found"
                                                   Style="{StaticResource SubtitleTextBlockStyle}"
                                                   HorizontalAlignment="Center"
                                                   Opacity="0.7"/>
                                        <TextBlock Text="Select shapes on the Drawing screen and save them as a template"
                                                   Style="{StaticResource CaptionTextBlockStyle}"
                                                   HorizontalAlignment="Center"
                                                   Opacity="0.5"
                                                   TextWrapping="Wrap"
                                                   MaxWidth="300"/>
                                    </StackPanel>

                                    <!-- Templates Grid -->
                                    <GridView ItemsSource="{x:Bind ViewModel.Templates, Mode=OneWay}"
                                              SelectionMode="None"
                                              IsItemClickEnabled="True"
                                              Visibility="{x:Bind ViewModel.HasTemplates, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}">
                                        <GridView.ItemsPanel>
                                            <ItemsPanelTemplate>
                                                <ItemsWrapGrid Orientation="Horizontal" ItemWidth="220"/>
                                            </ItemsPanelTemplate>
                                        </GridView.ItemsPanel>
                                        <GridView.ItemTemplate>
                                            <DataTemplate x:DataType="viewmodels:TemplateGroupViewModel">
                                                <Grid Width="200"
                                                      Height="200"
                                                      Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                                      BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                                      BorderThickness="1"
                                                      CornerRadius="8"
                                                      Padding="12"
                                                      Margin="4">
                                                    <Grid.ContextFlyout>
                                                        <MenuFlyout>
                                                            <MenuFlyoutItem Text="Delete"
                                                                            Command="{Binding ElementName=PageRoot, Path=ViewModel.DeleteTemplateCommand}"
                                                                            CommandParameter="{x:Bind}">
                                                                <MenuFlyoutItem.Icon>
                                                                    <FontIcon Glyph="&#xE74D;" Foreground="{ThemeResource SystemFillColorCriticalBrush}"/>
                                                                </MenuFlyoutItem.Icon>
                                                            </MenuFlyoutItem>
                                                        </MenuFlyout>
                                                    </Grid.ContextFlyout>
                                                    <Grid.RowDefinitions>
                                                        <RowDefinition Height="Auto"/>
                                                        <RowDefinition Height="*"/>
                                                        <RowDefinition Height="Auto"/>
                                                    </Grid.RowDefinitions>

                                                    <!-- Header -->
                                                    <Grid Grid.Row="0">
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="*"/>
                                                            <ColumnDefinition Width="Auto"/>
                                                        </Grid.ColumnDefinitions>

                                                        <TextBlock Grid.Column="0"
                                                                   Text="{x:Bind Name}"
                                                                   Style="{StaticResource BodyStrongTextBlockStyle}"
                                                                   TextTrimming="CharacterEllipsis"
                                                                   MaxLines="1"/>

                                                        <Button Grid.Column="1"
                                                                Command="{Binding ElementName=PageRoot, Path=ViewModel.DeleteTemplateCommand}"
                                                                CommandParameter="{x:Bind}"
                                                                Background="Transparent"
                                                                BorderThickness="0"
                                                                Padding="4"
                                                                ToolTipService.ToolTip="Delete Template">
                                                            <Button.Resources>
                                                                <SolidColorBrush x:Key="ButtonForegroundPointerOver" Color="{ThemeResource SystemFillColorCritical}"/>
                                                            </Button.Resources>
                                                            <FontIcon Glyph="&#xE74D;" FontSize="12"/>
                                                        </Button>
                                                    </Grid>

                                                    <!-- Thumbnail -->
                                                    <Border Grid.Row="1"
                                                            Background="{ThemeResource LayerFillColorDefaultBrush}"
                                                            BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                                            BorderThickness="1"
                                                            CornerRadius="4"
                                                            Margin="0,8">
                                                        <FontIcon Glyph="&#xE7C3;"
                                                                  FontSize="32"
                                                                  Opacity="0.3"
                                                                  HorizontalAlignment="Center"
                                                                  VerticalAlignment="Center"/>
                                                    </Border>

                                                    <!-- Info -->
                                                    <StackPanel Grid.Row="2" Spacing="2">
                                                        <TextBlock Style="{StaticResource CaptionTextBlockStyle}"
                                                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}">
                                                            <Run Text="{x:Bind ShapeCount}"/>
                                                            <Run Text="shapes"/>
                                                        </TextBlock>
                                                        <TextBlock Style="{StaticResource CaptionTextBlockStyle}"
                                                                   Foreground="{ThemeResource TextFillColorTertiaryBrush}">
                                                            <Run Text="Used"/>
                                                            <Run Text="{x:Bind UsageCount, Mode=OneWay}"/>
                                                            <Run Text="times"/>
                                                        </TextBlock>
                                                    </StackPanel>
                                                </Grid>
                                            </DataTemplate>
                                        </GridView.ItemTemplate>
                                    </GridView>
                                </Grid>
                            </Grid>
                        </TabViewItem.Content>
                    </TabViewItem>

                    <!-- Dashboard Tab -->
                    <TabViewItem Header="Dashboard" IsClosable="False">
                        <TabViewItem.IconSource>
                            <FontIconSource Glyph="&#xE9D2;"/>
                        </TabViewItem.IconSource>
                        <TabViewItem.Content>
                            <Grid Padding="24">
                                <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center" Spacing="16">
                                    <FontIcon Glyph="&#xE9D2;" FontSize="64" Opacity="0.4"/>
                                    <TextBlock Text="Dashboard"
                                               Style="{StaticResource TitleTextBlockStyle}"
                                               HorizontalAlignment="Center"/>
                                    <TextBlock Text="Statistics and analytics coming soon"
                                               Style="{StaticResource BodyTextBlockStyle}"
                                               Opacity="0.6"
                                               HorizontalAlignment="Center"/>
                                </StackPanel>
                            </Grid>
                        </TabViewItem.Content>
                    </TabViewItem>
                </TabView>
            </Border>

            <!-- Quick Templates Sidebar -->
            <Border Grid.Column="1"
                    Background="{ThemeResource LayerFillColorDefaultBrush}"
                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                    BorderThickness="1,0,0,0">
                <Grid Padding="16">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Header -->
                    <StackPanel Grid.Row="0" Spacing="4" Margin="0,0,0,16">
                        <TextBlock Text="Quick Templates"
                                   Style="{StaticResource SubtitleTextBlockStyle}"/>
                        <TextBlock Text="Most used templates"
                                   Style="{StaticResource CaptionTextBlockStyle}"
                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                    </StackPanel>

                    <!-- Templates List -->
                    <Grid Grid.Row="1">
                        <!-- Empty State -->
                        <StackPanel Visibility="{x:Bind ViewModel.HasTemplatesLoaded, Mode=OneWay, Converter={StaticResource InverseBoolToVisibilityConverter}}"
                                    VerticalAlignment="Center"
                                    HorizontalAlignment="Center"
                                    Spacing="12">
                            <FontIcon Glyph="&#xE7C3;" FontSize="32" Opacity="0.3"/>
                            <TextBlock Text="No templates yet"
                                       Style="{StaticResource CaptionTextBlockStyle}"
                                       HorizontalAlignment="Center"
                                       Opacity="0.5"/>
                        </StackPanel>

                        <!-- Templates ListView -->
                        <ListView ItemsSource="{x:Bind ViewModel.Templates, Mode=OneWay}"
                                  SelectionMode="None"
                                  Visibility="{x:Bind ViewModel.HasTemplatesLoaded, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}">
                            <ListView.ItemTemplate>
                                <DataTemplate x:DataType="viewmodels:TemplateGroupViewModel">
                                    <Grid Padding="8,12" ColumnSpacing="12">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="40"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <!-- Thumbnail -->
                                        <Border Grid.Column="0"
                                                Width="40"
                                                Height="40"
                                                Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                                BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                                BorderThickness="1"
                                                CornerRadius="4">
                                            <FontIcon Glyph="&#xE7C3;" FontSize="16" Opacity="0.5"/>
                                        </Border>

                                        <!-- Info -->
                                        <StackPanel Grid.Column="1" VerticalAlignment="Center" Spacing="2">
                                            <TextBlock Text="{x:Bind Name}"
                                                       Style="{StaticResource BodyTextBlockStyle}"
                                                       TextTrimming="CharacterEllipsis"
                                                       MaxLines="1"/>
                                            <TextBlock Style="{StaticResource CaptionTextBlockStyle}"
                                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}">
                                                <Run Text="{x:Bind ShapeCount}"/>
                                                <Run Text="shapes"/>
                                            </TextBlock>
                                        </StackPanel>

                                        <!-- Usage Count Badge -->
                                        <Border Grid.Column="2"
                                                Background="{ThemeResource AccentFillColorDefaultBrush}"
                                                CornerRadius="10"
                                                Padding="8,2"
                                                VerticalAlignment="Center">
                                            <TextBlock Text="{x:Bind UsageCount, Mode=OneWay}"
                                                       Style="{StaticResource CaptionTextBlockStyle}"
                                                       Foreground="White"/>
                                        </Border>
                                    </Grid>
                                </DataTemplate>
                            </ListView.ItemTemplate>
                        </ListView>
                    </Grid>
                </Grid>
            </Border>
        </Grid>
    </Grid>
</Page>
