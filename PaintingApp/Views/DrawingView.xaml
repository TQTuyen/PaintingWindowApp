<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="PaintingApp.Views.DrawingView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:viewmodels="using:PaintingApp.ViewModels"
    xmlns:controls="using:PaintingApp.Controls"
    xmlns:models="using:PaintingApp.Models"
    xmlns:local="using:PaintingApp.Views"
    mc:Ignorable="d"
    Background="Transparent">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="Auto"/>
        </Grid.ColumnDefinitions>

        <!-- Primary Toolbar: File Actions & Board Info -->
        <Grid Grid.Row="0"
              Grid.ColumnSpan="2"
              Background="{ThemeResource AcrylicInAppFillColorDefaultBrush}"
              BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
              BorderThickness="0,0,0,1"
              Padding="8,6">

            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <!-- File Actions (Left) -->
            <StackPanel Grid.Column="0"
                        Orientation="Horizontal"
                        Spacing="4">

                <Button Command="{x:Bind ViewModel.NewBoardCommand}"
                        ToolTipService.ToolTip="New Board (Ctrl+N)"
                        Padding="8,6">
                    <FontIcon Glyph="&#xE710;" FontSize="16"/>
                </Button>

                <Button Command="{x:Bind ViewModel.SaveBoardCommand}"
                        Style="{StaticResource AccentButtonStyle}"
                        ToolTipService.ToolTip="Save Board (Ctrl+S)"
                        Padding="8,6">
                    <FontIcon Glyph="&#xE74E;" FontSize="16"/>
                </Button>

                <Button Command="{x:Bind ViewModel.DeleteBoardCommand}"
                        ToolTipService.ToolTip="Delete Board"
                        Padding="8,6">
                    <Button.Resources>
                        <SolidColorBrush x:Key="ButtonForegroundPointerOver" Color="{ThemeResource SystemFillColorCritical}"/>
                    </Button.Resources>
                    <FontIcon Glyph="&#xE74D;" FontSize="16"/>
                </Button>

                <Border Width="1" Height="20" Margin="4,0"
                        Background="{ThemeResource DividerStrokeColorDefaultBrush}"/>

                <Button Command="{x:Bind ViewModel.SaveAsTemplateCommand}"
                        ToolTipService.ToolTip="Save selected shapes as template"
                        Padding="8,6">
                    <FontIcon Glyph="&#xE7C3;" FontSize="16"/>
                </Button>
            </StackPanel>

            <!-- Board Name (Center) -->
            <StackPanel Grid.Column="1"
                        Orientation="Horizontal"
                        Spacing="8"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center">
                <TextBlock Text="{x:Bind ViewModel.BoardName, Mode=OneWay}"
                           Style="{StaticResource BodyStrongTextBlockStyle}"
                           TextTrimming="CharacterEllipsis"
                           MaxWidth="300"/>
                <FontIcon Glyph="&#xE7BA;"
                          FontSize="12"
                          Foreground="{ThemeResource SystemFillColorCautionBrush}"
                          Visibility="{x:Bind ViewModel.HasUnsavedChanges, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"
                          ToolTipService.ToolTip="Unsaved changes"/>
            </StackPanel>

            <!-- Preview (Right) -->
            <Border Grid.Column="2"
                    Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                    BorderThickness="1"
                    CornerRadius="4"
                    Padding="8,4"
                    VerticalAlignment="Center">
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <TextBlock Text="Preview"
                               VerticalAlignment="Center"
                               Style="{StaticResource CaptionTextBlockStyle}"
                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                    <Canvas Width="50" Height="24">
                        <Rectangle Width="44" 
                                   Height="18"
                                   Canvas.Left="3"
                                   Canvas.Top="3"
                                   Stroke="{x:Bind ViewModel.StrokeColor, Mode=OneWay, Converter={StaticResource ColorToBrushConverter}}"
                                   StrokeThickness="{x:Bind ViewModel.StrokeThickness, Mode=OneWay}"
                                   StrokeDashArray="{x:Bind ViewModel.SelectedStrokeDashStyle, Mode=OneWay, Converter={StaticResource StrokeDashStyleToDoubleCollectionConverter}}"
                                   Fill="{x:Bind ViewModel.FillColor, Mode=OneWay, Converter={StaticResource ColorToBrushConverter}}"
                                   RadiusX="2"
                                   RadiusY="2"/>
                    </Canvas>
                </StackPanel>
            </Border>
        </Grid>

        <!-- Secondary Toolbar: Drawing Tools & Style Settings -->
        <Grid Grid.Row="1"
              Grid.ColumnSpan="2"
              Background="{ThemeResource LayerFillColorDefaultBrush}"
              BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
              BorderThickness="0,0,0,1"
              Padding="8,6">

            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <!-- Tool Selector -->
            <DropDownButton x:Name="ToolDropDown"
                            Grid.Column="0"
                            MinWidth="120"
                            Padding="8,6">
                <DropDownButton.Content>
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon x:Name="CurrentToolIcon"
                                  Glyph="&#xE7C9;"
                                  FontSize="16"/>
                        <TextBlock x:Name="CurrentToolText"
                                   Text="{x:Bind ViewModel.SelectedTool, Mode=OneWay}"/>
                    </StackPanel>
                </DropDownButton.Content>

                <DropDownButton.Flyout>
                    <MenuFlyout Placement="Bottom">
                        <MenuFlyoutItem Text="Select"
                                        Command="{x:Bind ViewModel.SelectToolCommand}"
                                        CommandParameter="Select"
                                        Click="ToolMenuItem_Click">
                            <MenuFlyoutItem.Icon>
                                <FontIcon Glyph="&#xE7C9;"/>
                            </MenuFlyoutItem.Icon>
                        </MenuFlyoutItem>

                        <MenuFlyoutSeparator/>

                        <MenuFlyoutItem Text="Line"
                                        Command="{x:Bind ViewModel.SelectToolCommand}"
                                        CommandParameter="Line"
                                        Click="ToolMenuItem_Click">
                            <MenuFlyoutItem.Icon>
                                <FontIcon Glyph="&#xE76D;"/>
                            </MenuFlyoutItem.Icon>
                        </MenuFlyoutItem>

                        <MenuFlyoutItem Text="Rectangle"
                                        Command="{x:Bind ViewModel.SelectToolCommand}"
                                        CommandParameter="Rectangle"
                                        Click="ToolMenuItem_Click">
                            <MenuFlyoutItem.Icon>
                                <FontIcon Glyph="&#xE739;"/>
                            </MenuFlyoutItem.Icon>
                        </MenuFlyoutItem>

                        <MenuFlyoutItem Text="Circle"
                                        Command="{x:Bind ViewModel.SelectToolCommand}"
                                        CommandParameter="Circle"
                                        Click="ToolMenuItem_Click">
                            <MenuFlyoutItem.Icon>
                                <FontIcon Glyph="&#xEA3A;"/>
                            </MenuFlyoutItem.Icon>
                        </MenuFlyoutItem>

                        <MenuFlyoutItem Text="Oval"
                                        Command="{x:Bind ViewModel.SelectToolCommand}"
                                        CommandParameter="Oval"
                                        Click="ToolMenuItem_Click">
                            <MenuFlyoutItem.Icon>
                                <FontIcon Glyph="&#xF138;"/>
                            </MenuFlyoutItem.Icon>
                        </MenuFlyoutItem>

                        <MenuFlyoutSeparator/>

                        <MenuFlyoutItem Text="Triangle"
                                        Command="{x:Bind ViewModel.SelectToolCommand}"
                                        CommandParameter="Triangle"
                                        Click="ToolMenuItem_Click">
                            <MenuFlyoutItem.Icon>
                                <FontIcon Glyph="&#xE879;"/>
                            </MenuFlyoutItem.Icon>
                        </MenuFlyoutItem>

                        <MenuFlyoutItem Text="Polygon"
                                        Command="{x:Bind ViewModel.SelectToolCommand}"
                                        CommandParameter="Polygon"
                                        Click="ToolMenuItem_Click">
                            <MenuFlyoutItem.Icon>
                                <FontIcon Glyph="&#xF408;"/>
                            </MenuFlyoutItem.Icon>
                        </MenuFlyoutItem>
                    </MenuFlyout>
                </DropDownButton.Flyout>
            </DropDownButton>

            <Border Grid.Column="1" Width="1" Height="20" Margin="8,0"
                    Background="{ThemeResource DividerStrokeColorDefaultBrush}"/>

            <!-- Style Settings (Scrollable) -->
            <ScrollViewer Grid.Column="2"
                          HorizontalScrollBarVisibility="Auto"
                          VerticalScrollBarVisibility="Disabled"
                          HorizontalScrollMode="Auto">
                <StackPanel Orientation="Horizontal" Spacing="8">
                    
                    <!-- Stroke Thickness -->
                    <StackPanel Orientation="Horizontal" Spacing="4" VerticalAlignment="Center">
                        <FontIcon Glyph="&#xEDA1;" FontSize="14" 
                                  Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                  ToolTipService.ToolTip="Stroke Thickness"/>
                        <Slider x:Name="ThicknessSlider"
                                Value="{x:Bind ViewModel.StrokeThickness, Mode=TwoWay}"
                                Minimum="0.5"
                                Maximum="20"
                                StepFrequency="0.5"
                                Width="80"
                                VerticalAlignment="Center"/>
                        <NumberBox Value="{x:Bind ViewModel.StrokeThickness, Mode=TwoWay}"
                                   Minimum="0.5"
                                   Maximum="50"
                                   SmallChange="0.5"
                                   SpinButtonPlacementMode="Compact"
                                   Width="65"
                                   VerticalAlignment="Center"/>
                    </StackPanel>

                    <Border Width="1" Height="20"
                            Background="{ThemeResource DividerStrokeColorDefaultBrush}"/>

                    <!-- Stroke Style -->
                    <ComboBox ItemsSource="{x:Bind ViewModel.AvailableDashStyles, Mode=OneWay}"
                              SelectedItem="{x:Bind ViewModel.SelectedStrokeDashStyle, Mode=TwoWay}"
                              MinWidth="100"
                              VerticalAlignment="Center"
                              ToolTipService.ToolTip="Stroke Style">
                        <ComboBox.ItemTemplate>
                            <DataTemplate x:DataType="models:StrokeDashStyle">
                                <StackPanel Orientation="Horizontal" Spacing="6">
                                    <Canvas Width="30" Height="14" VerticalAlignment="Center">
                                        <Line X1="0" Y1="7" X2="30" Y2="7"
                                              Stroke="{ThemeResource TextFillColorPrimaryBrush}"
                                              StrokeThickness="2"
                                              StrokeDashArray="{x:Bind local:DrawingView.GetDashArrayPreview((models:StrokeDashStyle))}"/>
                                    </Canvas>
                                    <TextBlock Text="{x:Bind}" VerticalAlignment="Center" FontSize="12"/>
                                </StackPanel>
                            </DataTemplate>
                        </ComboBox.ItemTemplate>
                    </ComboBox>

                    <Border Width="1" Height="20"
                            Background="{ThemeResource DividerStrokeColorDefaultBrush}"/>

                    <!-- Stroke Color -->
                    <Button x:Name="StrokeColorButton"
                            ToolTipService.ToolTip="Stroke Color"
                            Padding="6">
                        <StackPanel Orientation="Horizontal" Spacing="4">
                            <Border Width="20" Height="20"
                                    Background="{x:Bind ViewModel.StrokeColor, Mode=OneWay, Converter={StaticResource ColorToBrushConverter}}"
                                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                    BorderThickness="1"
                                    CornerRadius="2"/>
                            <TextBlock Text="Stroke" VerticalAlignment="Center" 
                                       Style="{StaticResource CaptionTextBlockStyle}"/>
                            <FontIcon Glyph="&#xE70D;" FontSize="8"/>
                        </StackPanel>
                        
                        <Button.Flyout>
                            <Flyout>
                                <StackPanel Spacing="12" Width="280">
                                    <TextBlock Text="Stroke Color" Style="{StaticResource BodyStrongTextBlockStyle}"/>
                                    
                                    <StackPanel Spacing="8">
                                        <TextBlock Text="Quick Colors" Style="{StaticResource CaptionTextBlockStyle}"/>
                                        <GridView SelectionMode="None" IsItemClickEnabled="True" ItemClick="StrokePresetColor_Click">
                                            <GridView.ItemsPanel>
                                                <ItemsPanelTemplate>
                                                    <ItemsWrapGrid Orientation="Horizontal" MaximumRowsOrColumns="8"/>
                                                </ItemsPanelTemplate>
                                            </GridView.ItemsPanel>
                                            
                                            <Border Background="#FF000000" Width="28" Height="28" CornerRadius="4" Margin="1" Tag="#FF000000" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1"/>
                                            <Border Background="#FFFF0000" Width="28" Height="28" CornerRadius="4" Margin="1" Tag="#FFFF0000" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1"/>
                                            <Border Background="#FFFF7F00" Width="28" Height="28" CornerRadius="4" Margin="1" Tag="#FFFF7F00" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1"/>
                                            <Border Background="#FFFFFF00" Width="28" Height="28" CornerRadius="4" Margin="1" Tag="#FFFFFF00" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1"/>
                                            <Border Background="#FF00FF00" Width="28" Height="28" CornerRadius="4" Margin="1" Tag="#FF00FF00" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1"/>
                                            <Border Background="#FF00FFFF" Width="28" Height="28" CornerRadius="4" Margin="1" Tag="#FF00FFFF" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1"/>
                                            <Border Background="#FF0000FF" Width="28" Height="28" CornerRadius="4" Margin="1" Tag="#FF0000FF" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1"/>
                                            <Border Background="#FF7F00FF" Width="28" Height="28" CornerRadius="4" Margin="1" Tag="#FF7F00FF" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1"/>
                                            <Border Background="#FFFFFFFF" Width="28" Height="28" CornerRadius="4" Margin="1" Tag="#FFFFFFFF" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="2"/>
                                            <Border Background="#FF808080" Width="28" Height="28" CornerRadius="4" Margin="1" Tag="#FF808080" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1"/>
                                            <Border Background="#FF8B0000" Width="28" Height="28" CornerRadius="4" Margin="1" Tag="#FF8B0000" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1"/>
                                            <Border Background="#FF006400" Width="28" Height="28" CornerRadius="4" Margin="1" Tag="#FF006400" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1"/>
                                            <Border Background="#FF00008B" Width="28" Height="28" CornerRadius="4" Margin="1" Tag="#FF00008B" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1"/>
                                            <Border Background="#FF8B4513" Width="28" Height="28" CornerRadius="4" Margin="1" Tag="#FF8B4513" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1"/>
                                            <Border Background="#FFFF69B4" Width="28" Height="28" CornerRadius="4" Margin="1" Tag="#FFFF69B4" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1"/>
                                            <Border Background="#FF87CEEB" Width="28" Height="28" CornerRadius="4" Margin="1" Tag="#FF87CEEB" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1"/>
                                        </GridView>
                                    </StackPanel>
                                    
                                    <Border Height="1" Background="{ThemeResource DividerStrokeColorDefaultBrush}"/>
                                    
                                    <Expander Header="Custom Color" HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch">
                                        <ColorPicker Color="{x:Bind ViewModel.StrokeColor, Mode=TwoWay}"
                                                     ColorSpectrumShape="Ring"
                                                     IsAlphaEnabled="True"/>
                                    </Expander>
                                </StackPanel>
                            </Flyout>
                        </Button.Flyout>
                    </Button>

                    <!-- Fill Color -->
                    <Button x:Name="FillColorButton"
                            ToolTipService.ToolTip="Fill Color"
                            Padding="6">
                        <StackPanel Orientation="Horizontal" Spacing="4">
                            <Border Width="20" Height="20"
                                    Background="{x:Bind ViewModel.FillColor, Mode=OneWay, Converter={StaticResource ColorToBrushConverter}}"
                                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                    BorderThickness="1"
                                    CornerRadius="2"/>
                            <TextBlock Text="Fill" VerticalAlignment="Center" 
                                       Style="{StaticResource CaptionTextBlockStyle}"/>
                            <FontIcon Glyph="&#xE70D;" FontSize="8"/>
                        </StackPanel>
                        
                        <Button.Flyout>
                            <Flyout>
                                <StackPanel Spacing="12" Width="280">
                                    <TextBlock Text="Fill Color" Style="{StaticResource BodyStrongTextBlockStyle}"/>
                                    
                                    <Button Content="No Fill (Transparent)" Click="NoFill_Click" HorizontalAlignment="Stretch"/>
                                    
                                    <StackPanel Spacing="8">
                                        <TextBlock Text="Quick Colors" Style="{StaticResource CaptionTextBlockStyle}"/>
                                        <GridView SelectionMode="None" IsItemClickEnabled="True" ItemClick="FillPresetColor_Click">
                                            <GridView.ItemsPanel>
                                                <ItemsPanelTemplate>
                                                    <ItemsWrapGrid Orientation="Horizontal" MaximumRowsOrColumns="8"/>
                                                </ItemsPanelTemplate>
                                            </GridView.ItemsPanel>
                                            
                                            <Border Background="#FF000000" Width="28" Height="28" CornerRadius="4" Margin="1" Tag="#FF000000" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1"/>
                                            <Border Background="#FFFF0000" Width="28" Height="28" CornerRadius="4" Margin="1" Tag="#FFFF0000" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1"/>
                                            <Border Background="#FFFF7F00" Width="28" Height="28" CornerRadius="4" Margin="1" Tag="#FFFF7F00" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1"/>
                                            <Border Background="#FFFFFF00" Width="28" Height="28" CornerRadius="4" Margin="1" Tag="#FFFFFF00" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1"/>
                                            <Border Background="#FF00FF00" Width="28" Height="28" CornerRadius="4" Margin="1" Tag="#FF00FF00" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1"/>
                                            <Border Background="#FF00FFFF" Width="28" Height="28" CornerRadius="4" Margin="1" Tag="#FF00FFFF" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1"/>
                                            <Border Background="#FF0000FF" Width="28" Height="28" CornerRadius="4" Margin="1" Tag="#FF0000FF" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1"/>
                                            <Border Background="#FF7F00FF" Width="28" Height="28" CornerRadius="4" Margin="1" Tag="#FF7F00FF" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1"/>
                                            <Border Background="#FFFFFFFF" Width="28" Height="28" CornerRadius="4" Margin="1" Tag="#FFFFFFFF" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="2"/>
                                            <Border Background="#FF808080" Width="28" Height="28" CornerRadius="4" Margin="1" Tag="#FF808080" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1"/>
                                            <Border Background="#FF8B0000" Width="28" Height="28" CornerRadius="4" Margin="1" Tag="#FF8B0000" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1"/>
                                            <Border Background="#FF006400" Width="28" Height="28" CornerRadius="4" Margin="1" Tag="#FF006400" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1"/>
                                            <Border Background="#FF00008B" Width="28" Height="28" CornerRadius="4" Margin="1" Tag="#FF00008B" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1"/>
                                            <Border Background="#FF8B4513" Width="28" Height="28" CornerRadius="4" Margin="1" Tag="#FF8B4513" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1"/>
                                            <Border Background="#FFFF69B4" Width="28" Height="28" CornerRadius="4" Margin="1" Tag="#FFFF69B4" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1"/>
                                            <Border Background="#FF87CEEB" Width="28" Height="28" CornerRadius="4" Margin="1" Tag="#FF87CEEB" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1"/>
                                        </GridView>
                                    </StackPanel>
                                    
                                    <Border Height="1" Background="{ThemeResource DividerStrokeColorDefaultBrush}"/>
                                    
                                    <Expander Header="Custom Color" HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch">
                                        <ColorPicker Color="{x:Bind ViewModel.FillColor, Mode=TwoWay}"
                                                     ColorSpectrumShape="Ring"
                                                     IsAlphaEnabled="True"/>
                                    </Expander>
                                </StackPanel>
                            </Flyout>
                        </Button.Flyout>
                    </Button>
                </StackPanel>
            </ScrollViewer>

            <!-- Canvas Size Info (Right) -->
            <StackPanel Grid.Column="3"
                        Orientation="Horizontal"
                        Spacing="4"
                        Margin="8,0,0,0"
                        VerticalAlignment="Center">
                <FontIcon Glyph="&#xE799;" FontSize="12" 
                          Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                <TextBlock Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                           Style="{StaticResource CaptionTextBlockStyle}">
                    <Run Text="{x:Bind ViewModel.CanvasWidth, Mode=OneWay}"/>
                    <Run Text="Ã—"/>
                    <Run Text="{x:Bind ViewModel.CanvasHeight, Mode=OneWay}"/>
                </TextBlock>
            </StackPanel>
        </Grid>

        <!-- Drawing Canvas Area -->
        <ScrollViewer Grid.Row="2"
                      Grid.Column="0"
                      HorizontalScrollBarVisibility="Auto"
                      VerticalScrollBarVisibility="Auto"
                      ZoomMode="Enabled"
                      MinZoomFactor="0.25"
                      MaxZoomFactor="4"
                      Background="{ThemeResource LayerFillColorDefaultBrush}">

            <Grid HorizontalAlignment="Center"
                  VerticalAlignment="Center"
                  Margin="24">

                <!-- Canvas Container -->
                <Border BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                        BorderThickness="2"
                        CornerRadius="4">
                    <Canvas x:Name="DrawingCanvas"
                            Width="{x:Bind ViewModel.CanvasWidth, Mode=OneWay}"
                            Height="{x:Bind ViewModel.CanvasHeight, Mode=OneWay}"
                            Background="{x:Bind ViewModel.CanvasBackgroundColor, Mode=OneWay, Converter={StaticResource ColorToBrushConverter}}"
                            PointerPressed="DrawingCanvas_PointerPressed"
                            PointerMoved="DrawingCanvas_PointerMoved"
                            PointerReleased="DrawingCanvas_PointerReleased"/>
                </Border>
            </Grid>
        </ScrollViewer>

        <!-- Properties Panel -->
        <controls:PropertiesPanel x:Name="ShapePropertiesPanel"
                                  Grid.Row="2"
                                  Grid.Column="1"
                                  Width="280"
                                  Visibility="{x:Bind ViewModel.HasSelection, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"
                                  SelectedShape="{x:Bind ViewModel.SelectedShape, Mode=OneWay}"
                                  ShapeDeleted="PropertiesPanel_ShapeDeleted"
                                  ShapePropertyChanged="PropertiesPanel_ShapePropertyChanged"/>
    </Grid>
</Page>
