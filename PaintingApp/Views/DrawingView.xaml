<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="PaintingApp.Views.DrawingView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:viewmodels="using:PaintingApp.ViewModels"
    mc:Ignorable="d"
    Background="Transparent">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Toolbar with Acrylic Background -->
        <Grid Grid.Row="0"
              Background="{ThemeResource AcrylicInAppFillColorDefaultBrush}"
              BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
              BorderThickness="0,0,0,1"
              Padding="12,8">

            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <!-- Tool Selector with Dropdown -->
            <StackPanel Grid.Column="0"
                        Orientation="Horizontal"
                        Spacing="8">

                <TextBlock Text="Tool:"
                           VerticalAlignment="Center"
                           Style="{StaticResource CaptionTextBlockStyle}"/>

                <DropDownButton x:Name="ToolDropDown"
                                MinWidth="140">
                    <DropDownButton.Content>
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <FontIcon x:Name="CurrentToolIcon"
                                      Glyph="&#xE7C9;"
                                      FontSize="16"/>
                            <TextBlock x:Name="CurrentToolText"
                                       Text="{x:Bind ViewModel.SelectedTool, Mode=OneWay}"/>
                        </StackPanel>
                    </DropDownButton.Content>

                    <DropDownButton.Flyout>
                        <MenuFlyout Placement="Bottom">
                            <MenuFlyoutItem Text="Select"
                                            Command="{x:Bind ViewModel.SelectToolCommand}"
                                            CommandParameter="Select"
                                            Click="ToolMenuItem_Click">
                                <MenuFlyoutItem.Icon>
                                    <FontIcon Glyph="&#xE7C9;"/>
                                </MenuFlyoutItem.Icon>
                            </MenuFlyoutItem>

                            <MenuFlyoutSeparator/>

                            <MenuFlyoutItem Text="Line"
                                            Command="{x:Bind ViewModel.SelectToolCommand}"
                                            CommandParameter="Line"
                                            Click="ToolMenuItem_Click">
                                <MenuFlyoutItem.Icon>
                                    <FontIcon Glyph="&#xE76D;"/>
                                </MenuFlyoutItem.Icon>
                            </MenuFlyoutItem>

                            <MenuFlyoutItem Text="Rectangle"
                                            Command="{x:Bind ViewModel.SelectToolCommand}"
                                            CommandParameter="Rectangle"
                                            Click="ToolMenuItem_Click">
                                <MenuFlyoutItem.Icon>
                                    <FontIcon Glyph="&#xE739;"/>
                                </MenuFlyoutItem.Icon>
                            </MenuFlyoutItem>

                            <MenuFlyoutItem Text="Circle"
                                            Command="{x:Bind ViewModel.SelectToolCommand}"
                                            CommandParameter="Circle"
                                            Click="ToolMenuItem_Click">
                                <MenuFlyoutItem.Icon>
                                    <FontIcon Glyph="&#xEA3A;"/>
                                </MenuFlyoutItem.Icon>
                            </MenuFlyoutItem>

                            <MenuFlyoutItem Text="Oval"
                                            Command="{x:Bind ViewModel.SelectToolCommand}"
                                            CommandParameter="Oval"
                                            Click="ToolMenuItem_Click">
                                <MenuFlyoutItem.Icon>
                                    <FontIcon Glyph="&#xF138;"/>
                                </MenuFlyoutItem.Icon>
                            </MenuFlyoutItem>

                            <MenuFlyoutSeparator/>

                            <MenuFlyoutItem Text="Triangle"
                                            Command="{x:Bind ViewModel.SelectToolCommand}"
                                            CommandParameter="Triangle"
                                            Click="ToolMenuItem_Click">
                                <MenuFlyoutItem.Icon>
                                    <FontIcon Glyph="&#xE879;"/>
                                </MenuFlyoutItem.Icon>
                            </MenuFlyoutItem>

                            <MenuFlyoutItem Text="Polygon"
                                            Command="{x:Bind ViewModel.SelectToolCommand}"
                                            CommandParameter="Polygon"
                                            Click="ToolMenuItem_Click">
                                <MenuFlyoutItem.Icon>
                                    <FontIcon Glyph="&#xF408;"/>
                                </MenuFlyoutItem.Icon>
                            </MenuFlyoutItem>
                        </MenuFlyout>
                    </DropDownButton.Flyout>
                </DropDownButton>
            </StackPanel>

            <!-- Board Actions -->
            <StackPanel Grid.Column="1"
                        Orientation="Horizontal"
                        Spacing="8"
                        Margin="16,0,0,0">

                <Border Width="1"
                        Height="24"
                        Background="{ThemeResource DividerStrokeColorDefaultBrush}"/>

                <Button Command="{x:Bind ViewModel.NewBoardCommand}"
                        ToolTipService.ToolTip="New Board (Ctrl+N)">
                    <StackPanel Orientation="Horizontal" Spacing="4">
                        <FontIcon Glyph="&#xE710;" FontSize="16"/>
                        <TextBlock Text="New"/>
                    </StackPanel>
                </Button>

                <Button Command="{x:Bind ViewModel.SaveBoardCommand}"
                        Style="{StaticResource AccentButtonStyle}"
                        ToolTipService.ToolTip="Save Board (Ctrl+S)">
                    <StackPanel Orientation="Horizontal" Spacing="4">
                        <FontIcon Glyph="&#xE74E;" FontSize="16"/>
                        <TextBlock Text="Save"/>
                    </StackPanel>
                </Button>

                <Border Width="1"
                        Height="24"
                        Background="{ThemeResource DividerStrokeColorDefaultBrush}"/>
            </StackPanel>

            <!-- Board Name Display -->
            <StackPanel Grid.Column="2"
                        Orientation="Horizontal"
                        Spacing="8"
                        Margin="8,0,0,0"
                        VerticalAlignment="Center">
                <TextBlock Text="{x:Bind ViewModel.BoardName, Mode=OneWay}"
                           Style="{StaticResource BodyStrongTextBlockStyle}"/>
                <FontIcon Glyph="&#xE7BA;"
                          FontSize="12"
                          Foreground="{ThemeResource SystemFillColorCautionBrush}"
                          Visibility="{x:Bind ViewModel.HasUnsavedChanges, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"
                          ToolTipService.ToolTip="Unsaved changes"/>
            </StackPanel>

            <!-- Stroke and Fill Settings -->
            <StackPanel Grid.Column="3"
                        Orientation="Horizontal"
                        Spacing="12">

                <!-- Stroke Thickness -->
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <TextBlock Text="Stroke:"
                               VerticalAlignment="Center"
                               Style="{StaticResource CaptionTextBlockStyle}"/>
                    <NumberBox Value="{x:Bind ViewModel.StrokeThickness, Mode=TwoWay}"
                               Minimum="0.5"
                               Maximum="50"
                               SmallChange="0.5"
                               SpinButtonPlacementMode="Compact"
                               Width="80"/>
                </StackPanel>

                <!-- Stroke Color -->
                <Button x:Name="StrokeColorButton"
                        Width="80"
                        ToolTipService.ToolTip="Stroke Color">
                    <StackPanel Orientation="Horizontal" Spacing="4">
                        <Border Width="20"
                                Height="20"
                                Background="{x:Bind ViewModel.StrokeColor, Mode=OneWay, Converter={StaticResource ColorToBrushConverter}}"
                                BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                BorderThickness="1"
                                CornerRadius="2"/>
                        <FontIcon Glyph="&#xE790;" FontSize="12"/>
                    </StackPanel>
                    <Button.Flyout>
                        <Flyout>
                            <StackPanel Spacing="8">
                                <TextBlock Text="Stroke Color"
                                           Style="{StaticResource BodyStrongTextBlockStyle}"/>
                                <ColorPicker Color="{x:Bind ViewModel.StrokeColor, Mode=TwoWay}"
                                             ColorSpectrumShape="Ring"
                                             IsAlphaEnabled="True"/>
                            </StackPanel>
                        </Flyout>
                    </Button.Flyout>
                </Button>

                <!-- Fill Color -->
                <Button x:Name="FillColorButton"
                        Width="80"
                        ToolTipService.ToolTip="Fill Color">
                    <StackPanel Orientation="Horizontal" Spacing="4">
                        <Border Width="20"
                                Height="20"
                                Background="{x:Bind ViewModel.FillColor, Mode=OneWay, Converter={StaticResource ColorToBrushConverter}}"
                                BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                BorderThickness="1"
                                CornerRadius="2"/>
                        <FontIcon Glyph="&#xE771;" FontSize="12"/>
                    </StackPanel>
                    <Button.Flyout>
                        <Flyout>
                            <StackPanel Spacing="8">
                                <TextBlock Text="Fill Color"
                                           Style="{StaticResource BodyStrongTextBlockStyle}"/>
                                <ColorPicker Color="{x:Bind ViewModel.FillColor, Mode=TwoWay}"
                                             ColorSpectrumShape="Ring"
                                             IsAlphaEnabled="True"/>
                            </StackPanel>
                        </Flyout>
                    </Button.Flyout>
                </Button>
            </StackPanel>
        </Grid>

        <!-- Drawing Canvas Area -->
        <ScrollViewer Grid.Row="1"
                      HorizontalScrollBarVisibility="Auto"
                      VerticalScrollBarVisibility="Auto"
                      ZoomMode="Enabled"
                      MinZoomFactor="0.25"
                      MaxZoomFactor="4"
                      Background="{ThemeResource LayerFillColorDefaultBrush}">

            <Grid HorizontalAlignment="Center"
                  VerticalAlignment="Center"
                  Margin="24">

                <!-- Canvas Container -->
                <Border BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                        BorderThickness="2"
                        CornerRadius="4">
                    <Canvas x:Name="DrawingCanvas"
                            Width="{x:Bind ViewModel.CanvasWidth, Mode=OneWay}"
                            Height="{x:Bind ViewModel.CanvasHeight, Mode=OneWay}"
                            Background="{x:Bind ViewModel.CanvasBackgroundColor, Mode=OneWay, Converter={StaticResource ColorToBrushConverter}}"
                            PointerPressed="DrawingCanvas_PointerPressed"
                            PointerMoved="DrawingCanvas_PointerMoved"
                            PointerReleased="DrawingCanvas_PointerReleased"/>
                </Border>

                <!-- Canvas Info Overlay -->
                <TextBlock VerticalAlignment="Bottom"
                           HorizontalAlignment="Left"
                           Margin="0,0,0,-24"
                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                           Style="{StaticResource CaptionTextBlockStyle}">
                    <Run Text="{x:Bind ViewModel.CanvasWidth, Mode=OneWay}"/>
                    <Run Text="Ã—"/>
                    <Run Text="{x:Bind ViewModel.CanvasHeight, Mode=OneWay}"/>
                    <Run Text="px"/>
                </TextBlock>
            </Grid>
        </ScrollViewer>
    </Grid>
</Page>
